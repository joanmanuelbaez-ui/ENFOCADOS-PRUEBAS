<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ENFOCADOS - TEST</title>
    <style>
        body{font-family:sans-serif; background:#fff9c4; display:flex; justify-content:center; padding-top:50px}
        .card{background:white; padding:30px; border-radius:15px; border:2px solid #2c3e50; width:100%; max-width:400px; text-align:center}
        input{width:100%; padding:12px; margin:15px 0; border:1px solid #ccc; border-radius:8px; box-sizing:border-box; display:block}
        button{width:100%; padding:12px; background:rgb(250,250,0); border:none; border-radius:8px; font-weight:bold; cursor:pointer}
        .hidden{display:none}
    </style>
</head>
<body>

<div class="card">
    <h1>ENFOCADOS</h1>
    <p>Entorno de Pruebas (ALUMNOS ACTIVOS)</p>
    
    <div id="secLogin">
        <h2>Acceso</h2>
        <input type="email" id="inEmail" placeholder="Escribe tu email aquí">
        <button id="btnLogin" onclick="doLogin()">Entrar</button>
    </div>

    <div id="secConfig" class="hidden">
        <h2>¡Bienvenido!</h2>
        <p>Has entrado al entorno de pruebas.</p>
        <button onclick="location.reload()">Salir</button>
    </div>
</div>

<script>
const apiUrl = 'https://script.google.com/macros/s/AKfycbwzQPNahJxw8YTLln-O9WaAkXoH3Vd0h7sFgugRxHX8bIEfasezvzl6ZvEENiTJMWKF/exec';

function fetchJSONP(url, callback) {
    const name = 'jsonp_' + Date.now();
    window[name] = (data) => { delete window[name]; callback(data); };
    const s = document.createElement('script');
    s.src = url + (url.includes('?') ? '&' : '?') + 'callback=' + name;
    document.body.appendChild(s);
}

function doLogin() {
    const email = document.getElementById('inEmail').value.trim().toLowerCase();
    const btn = document.getElementById('btnLogin');
    if(!email) return alert("Escribe un email");

    btn.textContent = "Verificando...";
    
    fetchJSONP(apiUrl + '?type=users', (res) => {
        const rows = res.rows || [];
        const headers = res.headers.map(h => h.toLowerCase().trim());
        const emailIdx = headers.indexOf('correo');

        const userExists = rows.find(row => row[emailIdx] && row[emailIdx].toLowerCase().trim() === email);

        if(userExists) {
            document.getElementById('secLogin').classList.add('hidden');
            document.getElementById('secConfig').classList.remove('hidden');
        } else {
            alert("Email no encontrado en la tabla ALUMNOS ACTIVOS de pruebas.");
            btn.textContent = "Entrar";
        }
    });
}
</script>

</body>
</html>
