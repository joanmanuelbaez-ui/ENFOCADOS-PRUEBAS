<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ENFOCADOS - PRUEBAS</title>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;800&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
<style>
/* Estilos Quirúrgicos */
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
:root{--Y:#FAFA00;--Yd:#E0E000;--D:#2C3E50;--D2:#1A252F;--V:#10B981;--R:#EF4444;--N:#F59E0B;--G:#64748B;--B:#E2E8F0;--F:#F8FAFC}
body{font-family:'Inter',sans-serif;background:linear-gradient(150deg,#FFFEF0,#FFF9C4);min-height:100vh;color:#1E293B;line-height:1.6}
.wrap{max-width:820px;margin:0 auto;padding:2rem 1.2rem}
header{text-align:center;margin-bottom:1.8rem}.titulo{font-family:'Montserrat',sans-serif;font-size:2.2rem;font-weight:800;color:var(--D);letter-spacing:-1px;text-transform:uppercase}
.card{background:#fff;border-radius:20px;padding:2rem;box-shadow:0 10px 25px rgba(0,0,0,0.05);border:2px solid var(--Y);margin-bottom:1.5rem;position:relative;overflow:hidden}
.field{margin-bottom:1.2rem}.field label{display:block;margin-bottom:0.5rem;font-weight:600;font-size:0.9rem;color:var(--G)}
.field input{width:100%;padding:0.8rem 1rem;border:2px solid var(--B);border-radius:12px;font-family:inherit;font-size:1rem;transition:all 0.2s}
.btn{width:100%;padding:1rem;background:var(--Y);color:var(--D);border:none;border-radius:12px;font-size:1rem;font-weight:700;cursor:pointer;font-family:'Montserrat',sans-serif;transition:all 0.2s;display:flex;align-items:center;justify-content:center;gap:0.5rem}
.btn:hover{background:var(--Yd);transform:translateY(-1px)}.btn:disabled{background:var(--B);color:var(--G);cursor:not-allowed}
.error-box{background:#FEF2F2;color:var(--R);padding:1rem;border-radius:12px;border:1px solid #FEE2E2;margin-bottom:1rem;font-size:0.9rem;display:none}
.hidden{display:none !important}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="titulo">ENFOCADOS</div>
    <div style="font-size:0.85rem;font-weight:600;color:var(--G)">ENTORNO DE PRUEBAS</div>
  </header>

  <div id="pLog" class="card">
    <div id="logErr" class="error-box"></div>
    <div class="field">
      <label>Tu correo electrónico</label>
      <input type="email" id="inEmail" placeholder="ejemplo@correo.com">
    </div>
    <button id="btnLog" class="btn" onclick="login()">PROBAR CONEXIÓN</button>
  </div>

  <div id="pCfg" class="card hidden">
    <h2 id="uNom" style="margin-bottom:1rem"></h2>
    <p style="color:var(--V);font-weight:700;font-size:1.2rem">✔️ CONEXIÓN EXITOSA</p>
    <p style="margin-top:10px;color:var(--G)">Los datos de la hoja <strong>"0 - BD GLOBAL"</strong> se están leyendo correctamente.</p>
    <button class="btn" style="margin-top:1.5rem;background:var(--F);color:var(--G)" onclick="location.reload()">CERRAR SESIÓN</button>
  </div>
</div>

<script>
// URL generada en el Paso 2
var GAS = 'https://script.google.com/macros/s/AKfycbw9MQnIJS-S0TEvukVEeHPAm11lKca1-c6BuT4V7ZqMr1X93m7P7Q5izKlXiSyrdHIz/exec';

function call(type, cb) {
  var id = 'jsonp_' + Date.now();
  var script = document.createElement('script');
  script.id = id;
  window[id] = function(data) {
    document.getElementById(id).remove();
    delete window[id];
    cb(data);
  };
  script.src = GAS + '?type=' + type + '&callback=' + id;
  document.head.appendChild(script);
}

function login() {
  var em = document.getElementById('inEmail').value.trim().toLowerCase();
  var btn = document.getElementById('btnLog');
  var err = document.getElementById('logErr');
  if(!em) return;

  btn.disabled = true;
  btn.textContent = 'Verificando en Google...';
  err.style.display = 'none';

  call('users', function(res){
    if (res.status === 'error') {
      err.textContent = 'Error del Servidor: ' + res.message;
      err.style.display = 'block';
      btn.disabled = false;
      btn.textContent = 'PROBAR CONEXIÓN';
      return;
    }
    
    // Buscar email en la columna CORREO
    var h = res.headers.map(function(s){ return s.toString().toUpperCase().trim(); });
    var mIdx = h.indexOf("CORREO");
    var user = res.rows.find(function(r){ return r[mIdx] && r[mIdx].toString().toLowerCase().trim() === em; });

    if(user) {
      document.getElementById('uNom').textContent = "HOLA, " + user[0];
      document.getElementById('pLog').classList.add('hidden');
      document.getElementById('pCfg').classList.remove('hidden');
    } else {
      err.textContent = 'Email no encontrado en ALUMNO_ACTIVOS.';
      err.style.display = 'block';
      btn.disabled = false;
      btn.textContent = 'PROBAR CONEXIÓN';
    }
  });
}
</script>
</body>
</html>
